//----------------------------------------------------------------------------------------------------
//библиотеки
//----------------------------------------------------------------------------------------------------

#include "watchdog.h"
#include "based.h"

//----------------------------------------------------------------------------------------------------
//макроопределения
//----------------------------------------------------------------------------------------------------

//----------------------------------------------------------------------------------------------------
//глобальные переменные
//----------------------------------------------------------------------------------------------------

//----------------------------------------------------------------------------------------------------
//прототипы функций
//----------------------------------------------------------------------------------------------------



//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
//функции
//++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


//----------------------------------------------------------------------------------------------------
//включение Watch Dog
//----------------------------------------------------------------------------------------------------
void WDT_WatchDogOn(void) 
{
 WDTCR=0x1F;//зачем-то нужно сначала записать все биты
 WDTCR=(1<<WDE)|(1<<WDP2)|(1<<WDP1)|(1<<WDP0)|(1<<WDCE);
 //WDE-включение сторожевого таймера
 //WDCE-разрешение изменение состояния сторожевого таймера
 //WDP0...WDP2 - делитель частоты (задан сброс каждые 2048 000 тактов) 
}
//----------------------------------------------------------------------------------------------------
//отключение Watch Dog
//----------------------------------------------------------------------------------------------------
void WDT_WatchDogOff(void) 
{
 WDT_Reset();
 WDTCR|=(1<<WDCE)|(1<<WDE);
 WDTCR=0x00;
}